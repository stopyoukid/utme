(function(){!function(a){var b,c,d,e,f,g,h,i;return h=a.map,f=a.extend,g=a.inArray,d=function(a,b){return-1!==g(a,b)},e=function(a){return a.replace(/([\!\"\#\$\%\&'\(\)\*\+\,\.\/\:\;<\=>\?\@\[\\\]\^\`\{\|\}\~])/g,"\\$1")},c=function(a,b){return h(a,function(a){return a===b?null:a})},i=function(a){return h(a,function(b,c){return parseInt(c,10)===parseInt(a.indexOf(b),10)?b:null})},b=function(){function b(b,c){this.element=b,this.options=f(f({},a.selectorator.options),c),this.cachedResults={}}return b.prototype.query=function(b){var c;return(c=this.cachedResults)[b]||(c[b]=a(b.replace(/#([^\s]+)/g,"[id='$1']")))},b.prototype.getProperTagName=function(){return this.element[0]?this.element[0].tagName.toLowerCase():null},b.prototype.hasParent=function(){return this.element&&0<this.element.parent().size()},b.prototype.isElement=function(){var a;return a=this.element[0],a&&a.nodeType===a.ELEMENT_NODE},b.prototype.validate=function(a,b,c,e){var f,g;if(null==c&&(c=!0),null==e&&(e=!1),g=this.query(a),c&&1<g.size()||!c&&0===g.size()){if(!b||-1!==a.indexOf(":"))return null;if(f=e?" > ":" ",a=b+f+a,g=this.query(a),c&&1<g.size()||!c&&0===g.size())return null}return d(this.element[0],g.get())?a:null},b.prototype.generate=function(){var a,b,d,e,f;if(!(this.element&&this.hasParent()&&this.isElement()))return[""];for(b=[],f=[this.generateSimple,this.generateAncestor,this.generateRecursive],d=0,e=f.length;e>d;d++)if(a=f[d],b=i(c(a.call(this))),b&&b.length>0)return b;return i(b)},b.prototype.generateAncestor=function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(g=[],p=this.element.parents(),j=0,m=p.length;m>j;j++){for(d=p[j],c=!0,i=this.generateSimple(null,!1),k=0,n=i.length;n>k;k++)for(h=i[k],f=new b(a(d),this.options).generateSimple(null,!1),l=0,o=f.length;o>l;l++)e=f[l],a.merge(g,this.generateSimple(e,!0,c));c=!1}return g},b.prototype.generateSimple=function(a,b,d){var e,f,g,i,j,k,l,m;for(g=this,i=g.getProperTagName(),j=function(c){return g.validate(c,a,b,d)},m=[[g.getIdSelector],[g.getClassSelector],[g.getIdSelector,!0],[g.getClassSelector,!0],[g.getNameSelector],[function(){return[g.getProperTagName()]}]],k=0,l=m.length;l>k;k++)if(e=m[k],f=e[0].call(g,e[1])||[],f=c(h(f,j)),f.length>0)return f;return[]},b.prototype.generateRecursive=function(){var a,c,d,e;return e=this.getProperTagName(),-1!==e.indexOf(":")&&(e="*"),c=this.element.parent(),d=new b(c).generate()[0],a=c.children(e).index(this.element),e=""+e+":eq("+a+")",""!==d&&(e=d+" > "+e),[e]},b.prototype.getIdSelector=function(a){var b;return null==a&&(a=!1),a=a?this.getProperTagName():"",b=this.element.attr("id"),"string"!=typeof b||d(b,this.getIgnore("id"))?null:[""+a+"#"+e(b)]},b.prototype.getClassSelector=function(a){var b,c,f;return null==a&&(a=!1),f=this.getProperTagName(),/^(body|html)$/.test(f)?null:(a=a?f:"",c=this.getIgnore("class"),b=(this.element.attr("class")||"").replace(/\{.*\}/,"").split(/\s/),h(b,function(b){return b&&!d(b,c)?""+a+"."+e(b):null}))},b.prototype.getNameSelector=function(){var a,b;return b=this.getProperTagName(),a=this.element.attr("name"),a&&!d(a,this.getIgnore("name"))?[""+b+"[name='"+a+"']"]:null},b.prototype.getIgnore=function(a){var b,c,d;return c=this.options.ignore||{},b="class"===a?"classes":""+a+"s",d=c[a]||c[b],"string"==typeof d?[d]:d},b}(),a.selectorator={options:{},unique:i,clean:c,escapeSelector:e},a.fn.selectorator=function(c){return new b(a(this),c)},a.fn.getSelector=function(a){return this.selectorator(a).generate()},this}(jQuery)}).call(this),function(){function a(a,b){for(var c in b)a[c]=b[c];return b}var b={event:function(b,c,d){var e;document.createEvent?(e=document.createEvent("HTMLEvents"),e.initEvent(c,"mouseenter"!=c&&"mouseleave"!=c,!0),a(e,d),b.dispatchEvent(e)):(e=document.createEventObject(),b.fireEvent("on"+c,e))},keyEvent:function(b,c,d){var e,f={bubbles:!0,cancelable:!0,view:window,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:0};if(a(f,d),document.createEvent)try{e=document.createEvent("KeyEvents"),e.initKeyEvent(c,f.bubbles,f.cancelable,f.view,f.ctrlKey,f.altKey,f.shiftKey,f.metaKey,f.keyCode,f.charCode),b.dispatchEvent(e)}catch(g){e=document.createEvent("Events"),e.initEvent(c,f.bubbles,f.cancelable),a(e,{view:f.view,ctrlKey:f.ctrlKey,altKey:f.altKey,shiftKey:f.shiftKey,metaKey:f.metaKey,keyCode:f.keyCode,charCode:f.charCode}),b.dispatchEvent(e)}}};b.keypress=function(a,b){var c=b.charCodeAt(0);this.keyEvent(a,"keypress",{keyCode:c,charCode:c})},b.keydown=function(a,b){var c=b.charCodeAt(0);this.keyEvent(a,"keydown",{keyCode:c,charCode:c})},b.keyup=function(a,b){var c=b.charCodeAt(0);this.keyEvent(a,"keyup",{keyCode:c,charCode:c})};for(var c=["click","focus","blur","dblclick","input","change","mousedown","mousemove","mouseout","mouseover","mouseup","mouseenter","mouseleave","resize","scroll","select","submit","load","unload"],d=c.length;d--;){var e=c[d];b[e]=function(a){return function(b,c){this.event(b,a,c)}}(e)}"undefined"!=typeof module?module.exports=b:"undefined"!=typeof window?window.Simulate=b:"undefined"!=typeof define&&define(function(){return b})}(),function(a,b){function c(a,b){if(p.length>0)p[0](a,b);else for(var c=s.state,d=0;d<c.scenarios.length;d++)c.scenarios[d].name==a&&b(c.scenarios[d])}function d(a,c){var d=a.steps[c];if(d){var g=s.state;if(g.runningScenario=a,g.runningStep=c,s.saveStateToStorage(g),"load"==d.eventName)window.location=d.data.url.href;else{var h=d.data.selectors;e(h,function(e){if("validate"===d.eventName){var g=$(e[0]).text();if(g!=d.data.text)return s.stopScenario(),void s.reportError("Expected: "+d.data.text+", but was: "+g)}var h=e[0];if(r.indexOf(d.eventName)>=0){var i={};d.data.button&&(i.which=i.button=d.data.button),"click"==d.eventName?$(h).trigger("click"):"focus"!=d.eventName&&"blur"!=d.eventName||!h[d.eventName]?b[d.eventName](h,i):h[d.eventName](),("undefined"!=typeof h.value||"undefined"!=typeof d.data.value)&&(h.value=d.data.value,b.event(h,"change"))}if("keypress"==d.eventName){var j=String.fromCharCode(d.data.keyCode);b.keypress(h,j),b.keydown(h,j),h.value=d.data.value,b.event(h,"change"),b.keyup(h,j)}f(a,c)},function(){"validate"==d.eventName?(s.reportError("Could not find appropriate element for selectors: "+JSON.stringify(h)+" for event "+d.eventName),s.stopScenario()):(s.reportLog("Could not find appropriate element for selectors: "+JSON.stringify(h)+" for event "+d.eventName),f(a,c))},500)}}}function e(a,b,c,d){function e(){for(var g,h=!1,i=!1,j=0;j<a.length;j++){if(g=$(a[j]),1==g.length){i=!0;break}g.length>1&&(h=!0)}i?b(g):(new Date).getTime()-f<d?setTimeout(e,20):c()}var f=(new Date).getTime();e()}function f(a,b){a.steps.length>b+1?"mousemove"==a.steps[b].eventName||a.steps[b].eventName.indexOf("key")>=0||"verify"==a.steps[b].eventName?d(a,b+1):(timeout=Math.max(g(a,b,b+1)/100,100),setTimeout(function(){d(a,b+1)},timeout)):s.stopScenario(!0)}function g(a,b,c){return a.steps[c].timeStamp-a.steps[b].timeStamp}function h(){for(var a=0;a<r.length;a++)document.addEventListener(r[a],function(a){var b=function(b){if("STARTED"==s.getStatus()&&b.target.hasAttribute&&!b.target.hasAttribute("data-ignore")){if(q)return b.stopPropagation(),b.preventDefault(),"mouseover"==a&&$(b.target).addClass("utme-verify"),"mouseout"==a&&$(b.target).removeClass("utme-verify"),("click"==a||"mousedown"==a)&&s.registerEvent("validate",{selectors:s.findSelectors(b.target),text:$(b.target).text()}),!1;var c={selectors:s.findSelectors(b.target),value:b.target.value};(b.which||b.button)&&(c.button=b.which||b.button),s.registerEvent(a,c)}};return b}(r[a]),!0);var b={188:"44",109:"45",190:"46",191:"47",192:"96",220:"92",222:"39",221:"93",219:"91",173:"45",187:"61",186:"59",189:"45"},c={96:"~",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",48:")",45:"_",61:"+",91:"{",93:"}",92:"|",59:":",39:'"',44:"<",46:">",47:"?"};document.addEventListener("keypress",function(a){if("STARTED"==s.getStatus()&&!a.target.hasAttribute("data-ignore")){var d=a.which;b.hasOwnProperty(d)&&(d=b[d]),d=!a.shiftKey&&d>=65&&90>=d?String.fromCharCode(d+32):a.shiftKey&&c.hasOwnProperty(d)?c[d]:String.fromCharCode(d),s.registerEvent("keypress",{selectors:s.findSelectors(a.target),key:d,prevValue:a.target.value,value:a.target.value+d,keyCode:a.keyCode})}},!0)}function i(a,b,c){var d=document.createElement("a");return d.className="utme-button "+b,d.setAttribute("data-ignore",!0),d.innerHTML=a,d.addEventListener("click",c),d}function j(a,b,c){a.className=c?a.className+" disabled":(a.className||"").replace(/ disabled/g,""),a.innerHTML=b}function k(){function a(){var a=s.getStatus();j(c,"STARTED"==a?"Stop Recording":"Record Scenario",q||"RUNNING"==a),j(d,"RUNNING"==a?"Stop Running":"Run Scenario",q||"STARTED"==a),j(e,q?"Done Validating":"Validate","STARTED"!=a)}var b=document.createElement("div");b.className="utme-bar";var c=i("Record Scenario","start",function(){var b=s.getStatus();"STARTED"==b?s.stopRecording():s.startRecording(),a()}),d=i("Run Scenario","run",function(){var b=s.getStatus();"LOADED"==b?s.runScenario():s.stopScenario(!1),a()}),e=i("Validate","verify",function(){var b=s.getStatus();"STARTED"==b&&(q=!q),a()});a(),b.appendChild(c),b.appendChild(d),b.appendChild(e),document.body.appendChild(b)}function l(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}var m,n=[],o=[],p=[],q=!1,r=["click","focus","blur","dblclick","mousedown","mouseenter","mouseleave","mouseout","mouseover","mouseup"],s={state:m,init:function(){var a=l("utme_scenario");a?(localStorage.clear(),m=s.state=s.loadStateFromStorage(),setTimeout(function(){s.runScenario(a)},2e3)):(m=s.state=s.loadStateFromStorage(),"RUNNING"===m.status?f(m.runningScenario,m.runningStep):m.status||(m.status="LOADED"))},startRecording:function(){localStorage.clear(),"STARTED"!=m.status&&(m.status="STARTED",m.steps=[],s.reportLog("Recording Started"))},runScenario:function(a){var b=a||prompt("Scenario to run");c(b,function(b){m.status="RUNNING",s.reportLog("Starting Scenario '"+a+"'",b),d(b,0)})},stopScenario:function(a){var b=m.runningScenario;delete m.runningStep,delete m.runningScenario,m.status="LOADED",s.reportLog("Stopping Scenario"),a&&s.reportLog("[SUCCESS] Scenario '"+b.name+"' Completed!")},getStatus:function(){return s.state.status},findSelectors:function(a){var b=$(a).selectorator().generate();return b},registerEvent:function(a,b){"STARTED"==m.status&&m.steps.push({eventName:a,timeStamp:(new Date).getTime(),data:b})},reportLog:function(a,b){if(o&&o.length)for(var c=0;c<o.length;c++)o[c].log(a,b,s)},reportError:function(a,b){if(o&&o.length)for(var c=0;c<o.length;c++)o[c].error(a,b,s)},registerSaveHandler:function(a){n.push(a)},registerReportHandler:function(a){o.push(a)},registerLoadHandler:function(a){p.push(a)},stopRecording:function(){var a={name:prompt("Enter scenario name"),steps:m.steps};if(a.name&&(m.scenarios.push(a),n&&n.length))for(var b=0;b<n.length;b++)n[b](a,s);m.status="LOADED",s.reportLog("Recording Stopped",a)},loadStateFromStorage:function(){var a=localStorage.getItem("utme");return m=a?JSON.parse(a):{status:"INITIALIZING",scenarios:[]}},saveStateToStorage:function(a){a?localStorage.setItem("utme",JSON.stringify(a)):localStorage.removeItem("utme")},unload:function(){s.saveStateToStorage(m)}};document.addEventListener("readystatechange",function(){"complete"==document.readyState&&(s.init(),k(),h(),"STARTED"==s.state.status&&s.registerEvent("load",{url:window.location}))}),window.addEventListener("unload",function(){s.unload()},!0),window.addEventListener("error",function(a){s.reportLog("Script Error: "+a.message+":"+a.url+","+a.line+":"+a.col)}),a.utme=s}(this,Simulate);var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(a){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(c){var d=b.createEvent("MouseEvents");d.initMouseEvent("click",!0,!1,a,0,0,0,0,0,!1,!1,!1,!1,0,null),c.dispatchEvent(d)},g=a.webkitRequestFileSystem,h=a.requestFileSystem||g||a.mozRequestFileSystem,i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=0,l=10,m=function(b){var d=function(){"string"==typeof b?c().revokeObjectURL(b):b.remove()};a.chrome?d():setTimeout(d,l)},n=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(f){i(f)}}},o=function(b,i){var l,o,p,q=this,r=b.type,s=!1,t=function(){n(q,"writestart progress write writeend".split(" "))},u=function(){if((s||!l)&&(l=c().createObjectURL(b)),o)o.location.href=l;else{var d=a.open(l,"_blank");void 0==d&&"undefined"!=typeof safari&&(a.location.href=l)}q.readyState=q.DONE,t(),m(l)},v=function(a){return function(){return q.readyState!==q.DONE?a.apply(this,arguments):void 0}},w={create:!0,exclusive:!1};return q.readyState=q.INIT,i||(i="download"),e?(l=c().createObjectURL(b),d.href=l,d.download=i,f(d),q.readyState=q.DONE,t(),void m(l)):(a.chrome&&r&&r!==j&&(p=b.slice||b.webkitSlice,b=p.call(b,0,b.size,j),s=!0),g&&"download"!==i&&(i+=".download"),(r===j||g)&&(o=a),h?(k+=b.size,void h(a.TEMPORARY,k,v(function(a){a.root.getDirectory("saved",w,v(function(a){var c=function(){a.getFile(i,w,v(function(a){a.createWriter(v(function(c){c.onwriteend=function(b){o.location.href=a.toURL(),q.readyState=q.DONE,n(q,"writeend",b),m(a)},c.onerror=function(){var a=c.error;a.code!==a.ABORT_ERR&&u()},"writestart progress write abort".split(" ").forEach(function(a){c["on"+a]=q["on"+a]}),c.write(b),q.abort=function(){c.abort(),q.readyState=q.DONE},q.readyState=q.WRITING}),u)}),u)};a.getFile(i,{create:!1},v(function(a){a.remove(),c()}),v(function(a){a.code===a.NOT_FOUND_ERR?c():u()}))}),u)}),u)):void u())},p=o.prototype,q=function(a,b){return new o(a,b)};return p.abort=function(){var a=this;a.readyState=a.DONE,n(a,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,q}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs}),function(a){a.registerSaveHandler(function(a){var b=new Blob([JSON.stringify(a)],{type:"text/plain;charset=utf-8"});saveAs(b,a.name+".json")})}(utme),function(a){function b(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}var c={baseUrl:b("utme_test_server")||"http://0.0.0.0:9043/",error:function(a){$.ajax({type:"POST",url:c.baseUrl+"error",data:{data:a},dataType:"json"}),console.error(a)},log:function(a){$.ajax({type:"POST",url:c.baseUrl+"log",data:{data:a},dataType:"json"}),console.log(a)},loadScenario:function(a,b){$.ajax({jsonp:"callback",url:c.baseUrl+"scenario/"+a,dataType:"jsonp",success:function(a){b(a)}})},saveScenario:function(a){$.ajax({type:"POST",url:c.baseUrl+"scenario",data:JSON.stringify(a),dataType:"json",contentType:"application/json"})}};a.registerReportHandler(c),a.registerLoadHandler(c.loadScenario),a.registerSaveHandler(c.saveScenario)}(utme,this);